{% extends 'cours/base_cours.html.twig' %}
{% set nav = 'participants' %}

{% block cours_content %}

    {% if is_granted('ROLE_PROFESSEUR') %}
        <!-- Permet aux professeurs d'ajouter un nouveau participant -->
        <div class="add mb-4">
            <form id="participantForm">
                <!-- Champ caché contenant le code du cours -->
                <input type="hidden" name="code_cours" id="code_cours" value="{{ cours.code }}">

                <label for="searchInput"><b>Nouveau participant</b></label>
                <!-- Champ de recherche pour trouver un participant -->
                <input type="text" name="etudiant" placeholder="Entrez un nom" required id="searchInput">

                <!-- Champ caché qui stocke l'ID de l'utilisateur sélectionné -->
                <input type="hidden" name="id_utilisateur" id="id_utilisateur">

                <!-- suggestions de recherche -->
                <div id="autocomplete-results" class="autocomplete-results"></div>

                <!-- ajouter un participant -->
                <button type="submit" class="add_button">Ajouter</button>
            </form>
        </div>
    {% endif %}

    <div class="row">
        <div class="col-md-6">
            <h2 class="mt-4 mb-3">Liste des Étudiants</h2>
            <ul id="participantList" class="list-group">
                {% for participant in participants %}
                    {% if participant.utilisateur is not null %}
                        {% if participant.utilisateur.getRoleByIndex(0) == 'ROLE_ELEVE' %}
                            <!--  étudiants inscrits dans le cours -->
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    {{ participant.utilisateur.prenom }} {{ participant.utilisateur.nom }}
                                </div>
                            </li>
                        {% endif %}
                    {% else %}
                        <li class="list-group-item text-muted">Participant sans utilisateur</li>
                    {% endif %}
                {% else %}
                    <li class="list-group-item text-center text-muted">Aucun participant inscrit</li>
                {% endfor %}
            </ul>
        </div>

        <div class="col-md-6">
            <h2 class="mt-4 mb-3">Professeurs</h2>
            <ul id="profList" class="list-group">
                {% for participant in participants %}
                    {% if participant.utilisateur is not null and participant.utilisateur.getRoleByIndex(0) == 'ROLE_PROFESSEUR' %}
                        <!-- professeurs associés au cours -->
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ participant.utilisateur.prenom }} {{ participant.utilisateur.nom }}</strong>
                                <!-- Lien mail du professeur -->
                                <a href="mailto:{{ participant.utilisateur.email }}" class="ms-2 text-decoration-none">
                                    {{ participant.utilisateur.email }}
                                </a>
                                {% if participant.utilisateur.id == participant.cours.getResponsableUe() %}
                                    <!-- Indication  responsable de l'UE -->
                                    <span class="badge bg-warning text-dark ms-2">Responsable de l'UE</span>
                                {% endif %}
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
                {% if participants|filter(p => p.utilisateur is not null and p.utilisateur.getRoleByIndex(0) == 'ROLE_PROFESSEUR') is empty %}
                    <li class="list-group-item text-center text-muted">Aucun professeur inscrit</li>
                {% endif %}
            </ul>
        </div>
    </div>

{% endblock %}

{% block cours_scripts %}
    <script src="{{ asset('scripts/add_participant.js') }}"></script>
{% endblock %}
