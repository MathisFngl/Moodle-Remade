{% extends 'cours/base_cours.html.twig' %}

{% set nav = 'participants' %}

{% block cours_content %}
    <div class="add mb-4">
        <form id="participantForm">
            <input type="hidden" name="code_cours" id="code_cours" value="{{ cours.code }}">

            <label for="searchInput"><b>Nouveau participant</b></label>
            <input type="text" name="etudiant" placeholder="Entrez un nom" required id="searchInput">
            <input type="hidden" name="id_utilisateur" id="id_utilisateur">
            <div id="autocomplete-results" class="autocomplete-results"></div>
            <button type="submit" class="add_button">Ajouter</button>
        </form>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h2 class="mb-3">Ã‰tudiants</h2>
            <ul id="etudiantList" class="list-group">
                {% for participant in participants %}
                    {% if participant.utilisateur is not null and participant.utilisateur.role != 'prof' %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ participant.utilisateur.prenom }} {{ participant.utilisateur.nom }}</strong>
                                <a href="mailto:{{ participant.utilisateur.email }}" class="ms-2 text-decoration-none">
                                    ğŸ“§ {{ participant.utilisateur.email }}
                                </a>
                                {% if participant.utilisateur.id == participant.cours.getResponsableUe() %}
                                    <span class="badge bg-warning text-dark ms-2">Responsable de l'UE</span>
                                {% endif %}
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
                {% if participants|filter(p => p.utilisateur is not null and p.utilisateur.role != 'prof') is empty %}
                    <li class="list-group-item text-center text-muted">Aucun Ã©tudiant inscrit</li>
                {% endif %}
            </ul>
        </div>

        <div class="col-md-6">
            <h2 class="mb-3">Professeurs</h2>
            <ul id="profList" class="list-group">
                {% for participant in participants %}
                    {% if participant.utilisateur is not null and participant.utilisateur.role == 'prof' %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ participant.utilisateur.prenom }} {{ participant.utilisateur.nom }}</strong>
                                <a href="mailto:{{ participant.utilisateur.email }}" class="ms-2 text-decoration-none">
                                     {{ participant.utilisateur.email }}
                                </a>
                                {% if participant.utilisateur.id == participant.cours.getResponsableUe() %}
                                    <span class="badge bg-warning text-dark ms-2">Responsable de l'UE</span>
                                {% endif %}
                            </div>
                        </li>
                    {% endif %}
                {% endfor %}
                {% if participants|filter(p => p.utilisateur is not null and p.utilisateur.role == 'prof') is empty %}
                    <li class="list-group-item text-center text-muted">Aucun professeur inscrit</li>
                {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}

{% block cours_scripts %}
    <script src="{{ asset('scripts/add_participant.js') }}"></script>
{% endblock %}
